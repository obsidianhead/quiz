<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Question Generator</title>
    <!-- Include Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="form-container" class="container my-5 p-4 bg-white rounded shadow">
        <!-- Display Course Name Here -->
        <h1 id="course-name" class="text-center mb-4"></h1>
        <h2 class="text-center mb-4">Add Quiz Question</h2>

        <!-- Status message for loading JSON -->
        <div id="status" class="text-center mb-3 text-danger"></div>

        <form id="question-form" class="mb-4">
            <div class="form-group">
                <label for="chapter">Chapter:</label>
                <select id="chapter" name="chapter" class="form-control" required>
                    <!-- Options will be populated dynamically -->
                </select>
            </div>

            <div class="form-group">
                <label for="question">Question:</label>
                <textarea id="question" name="question" class="form-control" rows="3" required></textarea>
            </div>

            <!-- Dropdown for Optional Image Selection -->
            <div class="form-group">
                <label for="image-select">Select Image (optional):</label>
                <select id="image-select" name="image-select" class="form-control">
                    <option value="">None</option>
                    <!-- Image options will be populated dynamically -->
                </select>
            </div>

            <label>Answers:</label>
            <div id="answers" class="btn-container mb-3">
                <div class="d-flex align-items-center mb-2">
                    <input type="text" name="answer" class="form-control mr-2" placeholder="Answer 1" required>
                    <div class="form-check">
                        <input type="radio" name="correct" class="form-check-input" value="0">
                        <label class="form-check-label">Correct</label>
                    </div>
                </div>
                <div class="d-flex align-items-center mb-2">
                    <input type="text" name="answer" class="form-control mr-2" placeholder="Answer 2" required>
                    <div class="form-check">
                        <input type="radio" name="correct" class="form-check-input" value="1">
                        <label class="form-check-label">Correct</label>
                    </div>
                </div>
                <div class="d-flex align-items-center mb-2">
                    <input type="text" name="answer" class="form-control mr-2" placeholder="Answer 3" required>
                    <div class="form-check">
                        <input type="radio" name="correct" class="form-check-input" value="2">
                        <label class="form-check-label">Correct</label>
                    </div>
                </div>
                <div class="d-flex align-items-center mb-2">
                    <input type="text" name="answer" class="form-control mr-2" placeholder="Answer 4" required>
                    <div class="form-check">
                        <input type="radio" name="correct" class="form-check-input" value="3">
                        <label class="form-check-label">Correct</label>
                    </div>
                </div>
            </div>

            <button type="button" class="btn btn-primary btn-block" onclick="addQuestion()">Add Question</button>
        </form>
        <h3 class="text-center mb-4">Generated JSON</h3>
        <textarea id="output" class="form-control mb-4" rows="10" readonly></textarea>
        <button class="btn btn-success btn-block" onclick="downloadJSON()">Download Updated JSON</button>
    </div>

    <!-- Include Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- JavaScript for quiz question generator -->
    <script>
        let questions = [];
        let config = {
            courseName: '',
            chapters: []
        };
        let images = []; // To store available images
        let selectedChapter = null; // Track the currently selected chapter

        // Load existing questions and configuration JSON automatically
        document.addEventListener('DOMContentLoaded', () => {
            loadConfigJSON();
            loadImagesFromAssets(); // Load images from assets folder
        });

        function loadConfigJSON() {
            fetch('quiz_config.json')
                .then(response => response.json())
                .then(data => {
                    config = data;
                    populateFormOptions();
                    document.getElementById('course-name').innerText = config.courseName; // Set course name
                })
                .catch(error => {
                    console.error('Error loading configuration JSON:', error);
                    document.getElementById('status').innerText =
                        'Failed to load configuration. Please check quiz_config.json.';
                });
        }

        function populateFormOptions() {
            const chapterSelect = document.getElementById('chapter');
            const imageSelect = document.getElementById('image-select');

            // Clear existing options
            chapterSelect.innerHTML = '';
            imageSelect.innerHTML = '<option value="">None</option>'; // Reset image options with the default "None"

            // Populate chapters
            config.chapters.forEach(chapter => {
            const option = document.createElement('option');
                option.value = chapter.number; // Store the chapter number in the value
                option.textContent = chapter.name; // Display the chapter name
                chapterSelect.appendChild(option);
                });

            // Populate images
            images.forEach(image => {
            const option = document.createElement('option');
            option.value = `assets/${image}`;
            option.textContent = image;
            imageSelect.appendChild(option);
            });
// Set a change event listener to load the questions for the selected chapter
chapterSelect.addEventListener('change', function () {
selectedChapter = this.value;
loadExistingJSON(selectedChapter); // Load questions from the selected chapter
});

// Trigger loadExistingJSON for the default chapter (first option) if exists
if (chapterSelect.options.length > 0) {
selectedChapter = chapterSelect.options[0].value;
loadExistingJSON(selectedChapter);
}
}

function loadExistingJSON(chapter) {
if (!chapter) {
document.getElementById('status').innerText = 'Please select a chapter.';
return;
            }

            const chapterQuestionsFile = `./chapters/${chapter}/questions.json`; // Load chapter-specific questions.json

            fetch(chapterQuestionsFile)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load existing questions. Starting with an empty set.');
                    }
                    return response.json();
                })
                .then(data => {
                    questions = Array.isArray(data) ? data : [];
                    updateOutput();
                    document.getElementById('status').innerText =
                    `Loaded questions for Chapter ${chapter} successfully!`;
                })
                .catch(error => {
                    console.error('Error loading JSON:', error);
                    questions = []; // Start with an empty array if loading fails
                    document.getElementById('status').innerText =
                        `Failed to load questions for Chapter ${chapter}. Starting with an empty set.`;
                });
        }

        function loadImagesFromAssets() {
            fetch('assets/images.json') // Assuming there's a JSON file listing the images
                .then(response => response.json())
                .then(data => {
                    images = data;
                    populateFormOptions();
                })
                .catch(error => {
                    console.error('Error loading images from assets folder:', error);
                    document.getElementById('status').innerText =
                        'Failed to load images. Please check assets folder.';
                });
        }

        function addQuestion() {
            const chapter = document.getElementById('chapter').value;
            const questionText = document.getElementById('question').value;
            const imageUrl = document.getElementById('image-select').value; // Get the selected image URL
            const answersElements = document.querySelectorAll('input[name="answer"]'); // Select by name
            const correctElement = document.querySelector('input[name="correct"]:checked');

            if (!correctElement) {
            alert('Please select a correct answer.');
            return;
            }

            const correctIndex = parseInt(correctElement.value);

            let answers = [];

            answersElements.forEach((answerElement, index) => {
            const answerText = answerElement.value.trim();

                if (answerText) {
                answers.push({
                text: answerText,
                correct: index === correctIndex // Determine if this is the correct answer
                });
                }
                });

            // Validate that there are actually answers
            if (answers.length === 0) {
            alert('Please provide at least one answer.');
            return;
            }

            const questionObject = {
                question: questionText,
                image: imageUrl ? imageUrl : null, // Include image URL if selected
                answers: answers
                };

            questions.push(questionObject);
            document.getElementById('question-form').reset();
            updateOutput();
// Ensure the questions for the current chapter are reloaded after adding the question
loadExistingJSON(chapter);
        }

        function updateOutput() {
            document.getElementById('output').value = JSON.stringify(questions, null, 2);
        }

        function downloadJSON() {
            if (!selectedChapter) {
            alert('Please select a chapter to download questions for.');
            return;
            }

            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(questions, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `questions_chapter_${selectedChapter}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }
    </script>
</body>

</html>
